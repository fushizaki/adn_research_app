{% extends "base.html" %}
{% block main %}

<section class="h-full w-full flex items-center justify-center min-h-screen" style="background: radial-gradient(circle at center, rgba(0, 179, 54, 1) 0%, rgba(0, 91, 27, 1) 20%, rgba(0, 0, 0, 1) 50%);">
<article class="rounded-xl bg-gray-div shadow-md p-10 border border-green-500 w-full mx-auto max-w-4xl max-h-[calc(100vh-120px)] overflow-y-auto px-4">
        <header class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
                <h1 class="text-3xl font-bold text-white">Gérer les séquences ADN</h1>
                <p class="text-green-400 text-sm mb-6">Générez ou chargez une séquence pour leur appliquer des traitements.</p>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <aside class="space-y-4 mt-4 mb-4" aria-label="Notifications">
                    {% for category, message in messages %}
                        <article class="px-4 py-3 rounded-lg text-sm {% if category == 'erreur' %}bg-red-900/40 border border-red-500 text-red-200{% elif category == 'succes' %}bg-green-900/40 border border-green-500 text-green-200{% else %}bg-gray-800 text-white{% endif %}" role="status">
                            {{ message }}
                        </article>
                    {% endfor %}
                </aside>
            {% endif %}
        {% endwith %}

        <section class="grid grid-cols-1 lg:grid-cols-2 gap-6" aria-label="Actions principales">
            <form method="POST" class="rounded-3xl border border-green-button/40 bg-black/40 p-6 space-y-4">
                {{ form_generer.hidden_tag() }}
                <h2 class="text-xl font-semibold text-white">Générer une séquence aléatoire</h2>
                <label class="text-sm text-green-300" for="{{ form_generer.longueur.id }}">Longueur souhaitée</label>
                {{ form_generer.longueur(class="w-full rounded-lg bg-gray-900 border border-green-button/50 px-3 py-2 text-white", placeholder="ex: 120") }}
                <label class="text-sm text-green-300" for="{{ form_generer.nom_fichier.id }}">Nom de fichier</label>
                {{ form_generer.nom_fichier(class="w-full rounded-lg bg-gray-900 border border-green-button/50 px-3 py-2 text-white", placeholder="ex: specimen_alpha") }}
                {{ form_generer.submit_generer(class="w-full mt-2 bg-green-button hover:bg-green-button-hover text-black font-semibold py-2 rounded-xl transition") }}
                {% if sequence_creee %}
                    <div class="mt-4 space-y-2">
                        <p class="text-sm text-green-300">Dernière séquence générée ({{ sequence_creee.nom }}) :</p>
                        <textarea readonly class="w-full rounded-lg bg-gray-900 border border-green-button/30 px-3 py-2 text-xs text-white h-24">{{ sequence_creee.contenu }}</textarea>
                    </div>
                {% endif %}
            </form>

            <form method="POST" enctype="multipart/form-data" class="rounded-3xl border border-green-button/40 bg-black/40 p-6 space-y-4">
                {{ form_charger.hidden_tag() }}
                <h2 class="text-xl font-semibold text-white">Charger un fichier ADN</h2>
                <label class="text-sm text-green-300" for="{{ form_charger.fichier_adn.id }}">Il doit etre au format .adn</label>
                {{ form_charger.fichier_adn(class="w-full rounded-lg bg-gray-900 border border-green-button/50 px-3 py-2 text-white", accept=".adn,.txt") }}
                {{ form_charger.submit_charger(class="w-full mt-2 bg-green-button hover:bg-green-button-hover text-black font-semibold py-2 rounded-xl transition") }}
                {% if fichier_charge %}
                    <p class="text-sm text-green-300">{{ fichier_charge.nom }} ({{ fichier_charge.taille }} bases) ajouté.</p>
                {% endif %}
            </form>
        </section>

        <form method="POST" class="rounded-3xl border border-green-button/40 bg-black/30 p-6 space-y-4">
            {{ form_choisir.hidden_tag() }}
            <header class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                <div>
                    <h2 class="text-xl font-semibold text-white">Sélectionner les séquences à traiter</h2>
                    <p class="text-sm text-green-300">Choisissez une ou plusieurs séquences pour accéder aux traitements.</p>
                </div>
                {{ form_choisir.submit_traitements(class="inline-flex items-center justify-center px-5 py-3 rounded-xl bg-green-button text-black font-semibold hover:bg-green-button-hover transition") }}
            </header>

            <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4" aria-label="Liste des fichiers ADN">
                {% set selection = form_choisir.sequences.data or [] %}
                {% for fichier in fichiers %}
                    <label class="block border border-green-button/30 rounded-2xl p-4 bg-gray-900/60 cursor-pointer hover:border-green-button">
                        <div class="flex items-start gap-3">
                            <input type="checkbox" class="mt-1" name="sequences" value="{{ fichier.nom }}" {% if fichier.nom in selection %}checked{% endif %}>
                            <div>
                                <p class="font-semibold text-white">{{ fichier.nom }}</p>                            </div>
                        </div>
                    </label>
                {% else %}
                    <p class="text-sm text-gray-300">Aucun fichier .adn trouvé. Générez ou chargez une séquence pour commencer.</p>
                {% endfor %}
            </section>
        </form>
    </article>
</section>
{% endblock %}
