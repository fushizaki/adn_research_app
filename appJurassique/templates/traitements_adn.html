{% extends "base.html" %}
{% block main %}

<section class="h-full w-full flex items-center justify-center min-h-screen" style="background: radial-gradient(circle at center, rgba(0, 179, 54, 1) 0%, rgba(0, 91, 27, 1) 20%, rgba(0, 0, 0, 1) 50%);">
    <article class="rounded-[40px] bg-gray-div shadow-md p-10 mt-2 border border-green-500 w-full mx-4 space-y-8" style="max-width: 960px; max-height: calc(100vh - 120px); overflow-y: auto;">
        <header class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
            <div>
                <h1 class="text-3xl font-bold text-white">Traitements ADN</h1>
                <p class="text-green-300 text-sm">Activez un, deux ou trois types de mutations et ajoutez une analyse de distance.</p>
            </div>
            <a href="{{ url_for('gerer_adn') }}" class="inline-flex items-center justify-center px-5 py-3 rounded-xl bg-black text-green-200 border border-green-button/60 hover:bg-gray-900 transition">Retour</a>
        </header>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <aside class="space-y-2" aria-label="Notifications">
                    {% for category, message in messages %}
                        <article class="px-4 py-3 rounded-lg text-sm {% if category == 'erreur' %}bg-red-900/40 border border-red-500 text-red-200{% elif category == 'succes' %}bg-green-900/40 border border-green-500 text-green-200{% else %}bg-gray-800 text-white{% endif %}" role="status">
                            {{ message }}
                        </article>
                    {% endfor %}
                </aside>
            {% endif %}
        {% endwith %}

        {% if preselected %}
            <section class="flex flex-wrap gap-2" aria-label="Sélection actuelle">
                <span class="text-sm text-green-200">Séquences importées :</span>
                {% for item in preselected %}
                    <span class="text-xs bg-green-button/20 border border-green-button/60 text-green-100 px-2 py-1 rounded-full">{{ item }}</span>
                {% endfor %}
            </section>
        {% endif %}

        <form method="POST" class="space-y-8">
            {{ form_traitement.hidden_tag() }}
            <section class="rounded-3xl border border-green-button/30 bg-black/40 p-6 space-y-4">
                <h2 class="text-xl font-semibold text-white">1. Choisir la séquence de base</h2>
                <label for="{{ form_traitement.sequence_base.id }}" class="text-sm text-green-200">Séquence à traiter</label>
                {{ form_traitement.sequence_base(class="w-full rounded-lg bg-gray-900 border border-green-button/40 px-3 py-2 text-white") }}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="{{ form_traitement.proba.id }}" class="text-sm text-green-200">Probabilité p (0 à 1)</label>
                        {{ form_traitement.proba(class="w-full rounded-lg bg-gray-900 border border-green-button/40 px-3 py-2 text-white", step="0.01", min="0", max="1") }}
                    </div>
                    <div class="text-sm text-gray-200">
                        <p>Le même p est utilisé pour chaque mutation activée.</p>
                        <p>Vous pouvez activer les trois mutations en meme temps.</p>
                    </div>
                </div>
            </section>

            <section class="rounded-3xl border border-green-button/30 bg-black/40 p-6 space-y-4">
                <h2 class="text-xl font-semibold text-white">2. Sélectionner les mutations à appliquer</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <label class="border border-green-button/40 rounded-2xl p-4 bg-gray-900/60 cursor-pointer hover:border-green-button">
                        {{ form_traitement.mutation_remplacement(class="mr-2") }}
                        <span class="font-semibold text-white">Remplacement</span>
                        <p class="text-xs text-green-200 mt-2">Substitue des nucléotides.</p>
                    </label>
                    <label class="border border-green-button/40 rounded-2xl p-4 bg-gray-900/60 cursor-pointer hover:border-green-button">
                        {{ form_traitement.mutation_insertion(class="mr-2") }}
                        <span class="font-semibold text-white">Insertion</span>
                        <p class="text-xs text-green-200 mt-2">Ajoute des nucléotides.</p>
                    </label>
                    <label class="border border-green-button/40 rounded-2xl p-4 bg-gray-900/60 cursor-pointer hover:border-green-button">
                        {{ form_traitement.mutation_deletion(class="mr-2") }}
                        <span class="font-semibold text-white">Délétion</span>
                        <p class="text-xs text-green-200 mt-2">Supprime des nucléotides.</p>
                    </label>
                </div>
            </section>

            <section class="rounded-3xl border border-green-button/30 bg-black/40 p-6 space-y-4">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                    <div>
                        <h2 class="text-xl font-semibold text-white">3. Distance de Levenshtein</h2>
                        <p class="text-sm text-red-500">ATTENTION !! Ce calcul ne fonctionne qu'avec de très courtes séquences. Sélectionnez en deux.</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="{{ form_traitement.sequence_lev_a.id }}" class="text-sm text-green-200">Séquence 1</label>
                        {{ form_traitement.sequence_lev_a(class="w-full rounded-lg bg-gray-900 border border-green-button/40 px-3 py-2 text-white") }}
                    </div>
                    <div>
                        <label for="{{ form_traitement.sequence_lev_b.id }}" class="text-sm text-green-200">Séquence 2</label>
                        {{ form_traitement.sequence_lev_b(class="w-full rounded-lg bg-gray-900 border border-green-button/40 px-3 py-2 text-white") }}
                    </div>
                </div>
            </section>

            <footer class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <p class="text-sm text-green-200">Les résultats complets seront dispos sur la page résultats!</p>
                {{ form_traitement.submit_traiter(class="inline-flex items-center justify-center px-6 py-3 rounded-xl bg-green-button text-black font-semibold hover:bg-green-button-hover transition") }}
            </footer>
        </form>
    </article>
</section>

{% endblock %}
